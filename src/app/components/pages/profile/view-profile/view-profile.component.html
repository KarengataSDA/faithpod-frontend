<app-page-header  [title]="'User Details'" [items]="['User']" [active_item]="'User Details'"></app-page-header>

<div class="row" id="user-profile">
    <div class="col-lg-12">
      <div class="card">
        <div class="card-body">
          <div class="wideget-user">
            <div class="row">
              <div class="col-lg-12 col-md-12">
                <div class="card p-0 shadow-none">
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="d-flex">
                                <div class="media p-5">
                                  <!-- <div class="media-user me-2">
                                      <img
                                        alt=""
                                        class="rounded-circle avatar avatar-md mb-5"
                                        src="./assets/images/users/profile.png"
                                        style="height: 100px; width: 100px;"
                                      />
                                  </div> -->
                                  <div class="media overflow-visible mt-sm-5" >
                                    <span  style="height: 60px; width: 60px;" class="avatar cover-image avatar-md brround bg-primary me-3">
                                      <h3 style="margin-top: 15px; margin-left: 0px; font-weight: bold;" >{{ (user?.first_name?.charAt(0) || '') + (user?.last_name?.charAt(0) || '')}}</h3>
                                    </span>
                                    <div class="text-dark">
                                      <h3 *ngIf="user"> {{user.first_name }} {{ user.last_name}}</h3>
                                     
                                      <button
                                      class="btn btn-sm d-block"
                                      [ngClass]="{
                                        ' btn-yellow ': user?.membershiptype?.name === 'visitor',
                                        ' btn-primdary': user?.membershiptype?.name === 'member',
                                        ' btn-success': user?.membershiptype?.name === 'sabbath'
                                      }"
                                      >{{user?.membershiptype?.name}}</button
                                    >
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <div class="p-5 col-lg-8 col-md-4">
                                <div class="chat-details mb-1 p-3">
                                  <h4 class="mb-0">
                                      <span class="h5 fw-normal">Profile Percentage</span>
                                      <span class="float-end p-1  btn btn-sm text-default">
                                          <b>{{completionPercentage}}</b>%</span>
                                  </h4>
                                  <div class="progress progress-sm mt-3">
                                      <div class="progress-bar"  [ngClass]="{
                                        'bg-danger': completionPercentage < 50,
                                        'bg-warning': completionPercentage >= 50 && completionPercentage < 75,
                                        'bg-primary': completionPercentage >= 75
                                      }"
                                       [style.width]="completionPercentage + '%'"></div>
                                  </div>
                                  <div *ngIf="unfilledFields.length > 0" class="mt-3">
                                    <span class="mb-0">Fields Not Updated:</span>
                                    <ul>
                                      <h6 *ngFor="let field of unfilledFields" class=" mt-2 mb-0 text-danger">{{field}}</h6>
                                      
                                    </ul>
                                  </div>
                              </div>
                              </div>
                        </div>
        <div class="col-lg-6">
                            
                             
          <div class="card-header">
            <div class="card-title">About</div>
          </div>
          <div class="card-body">
            <div class="d-flex align-items-center mb-3 mt-3">
              <div class="me-4 text-center text-primary">
                <span><i class="fe fe-calendar fs-20"></i></span>
              </div>
              <div>
                <strong>{{user?.date_of_birth}} </strong>
              </div>
            </div>
            <div class="d-flex align-items-center mb-3 mt-3">
              <div class="me-4 text-center text-primary">
                <span><i class="fe fe-phone fs-20"></i></span>
              </div>
              <div>
                <strong *ngIf="user">{{user?.phone_number}} </strong>
              </div>
            </div>
            <div class="d-flex align-items-center mb-3 mt-3">
              <div class="me-4 text-center text-primary">
                <span><i class="fe fe-mail fs-20"></i></span>
              </div>
              <div>
                <strong *ngIf="user" >{{user?.email}} </strong>
              </div>
            </div>
            <div class="d-flex align-items-center mb-3 mt-3">
              <div class="me-4 text-center text-primary">
                <span><i class="fe fe-user fs-20"></i></span>
              </div>
              <div>
                <strong *ngIf="user" >{{user.gender}} </strong>
              </div>
            </div>
          </div>
          <div class="card-footer text-end">
            <a  class="btn ms-2 btn-primary my-1" routerLink="/pages/edit-profile">
               Edit Profile
            </a>
          </div>
        </div>
                        
                    </div>
                </div>
                  
              </div>
            </div>
          </div>
        </div>
      </div>
     
    </div>
    <!-- COL-END -->
  </div>

<!-- ROW-1 OPEN -->
<div class="row">
  <div class="col-xl-12 col-md-12">
    <div class="card productdesc">
      <div class="card-body">
        <div class="panel panel-primary">
          <div class="tab-menu-heading">
            <div class="tabs-menu1">
              <!-- Tabs -->
              <ul ngbNav #nav="ngbNav" [activeId]="1" class="panel-tabs">
                <li [ngbNavItem]="1">
                  <a ngbNavLink>Givings</a>
                  <ng-template ngbNavContent>
                    <div class="tab-pane active  pt-5" id="tab5">
                      <div class="table-responsive">
                        <div class="card-footer text-end">
                          <a  class="btn ms-2 btn-primary my-1" routerLink="/pages/treasury/my-collections/create">
                             Add Contribution
                          </a>
                        </div>
                        <table class="table table-bordered text-nowrap mb-0">
                            <thead class="border-top">
                                <tr>
                                  <th>Contribution Date</th>
                                  <th>No.</th>
                                  <th>Category</th>
                                  <th>Total</th>
                                  <!-- <th>Status(email)</th>
                                  <th>Action</th> -->
                                </tr>
                            </thead>
                            <tbody >
                              <ng-container *ngIf="user?.contributions as contributions">
                                <tr class="border-bottom" *ngFor="let collection of contributions; index as i">
                                    <td *ngIf="i === 0 || user.contributions[i].contribution_date !== user.contributions[i-1].contribution_date" [attr.rowspan]="getRowspan(user.contributions, collection.contribution_date)">{{collection.contribution_date}}</td>
                                    <th>{{i + 1}}</th>
                                    <td>{{collection?.contribution_type?.name}}</td>
                                    <td>{{collection?.contribution_amount}}</td>
                                </tr>
                                </ng-container>
                            </tbody>
                        </table>
                    </div>
                    </div>
                  </ng-template>
                </li>
                <li [ngbNavItem]="2">
                  <a ngbNavLink>User Details</a>
                  <ng-template ngbNavContent>
                    <div class="tab-pane pt-5" id="tab6">
                      <div class="table-responsive">
                        <table class="table table-bordered" *ngIf="user">
                          <tr>
                            <td class="fw-bold">Population Group</td>
                            <td>{{user.population_group.name}}</td>
                          </tr>
                          <tr>
                            <td class="fw-bold">Prayercell</td>
                            <td>{{user.prayercell.name}}</td>
                          </tr>
                        </table>
                      </div>
                    </div>
                  </ng-template>
                </li>
                <li [ngbNavItem]="3">
                  <a ngbNavLink>Family Details</a>
                  <ng-template ngbNavContent>
                    <div class="tab-pane" id="tab7">
                      <ul class="p-5">
                        <li>
                          <i class="fa fa-check me-3 text-success mb-5"></i
                          >Family Details
                        </li>
                        <li>
                          <i class="fa fa-check me-3 text-success mb-5"></i>Other Details
                        </li>
                      </ul>
                    </div>
                  </ng-template>
                </li>
              </ul>
            </div>
          </div>
          <div class="panel-body tabs-menu-body">
            <div [ngbNavOutlet]="nav"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- ROW-1 CLOSED -->
